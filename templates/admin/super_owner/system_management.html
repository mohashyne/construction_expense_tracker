{% extends "super_owner_base.html" %}

{% block page_title %}System Management{% endblock %}
{% block page_subtitle %}System tools, maintenance, and administrative functions{% endblock %}

{% block main_content %}
<div class="row">
    <div class="col-12">
        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-database fa-2x text-primary mb-3"></i>
                        <h6 class="card-title">Backup Management</h6>
                        <p class="card-text text-muted">Create, download, and manage system backups</p>
                        <a href="{% url 'core:backup_management' %}" class="btn btn-primary btn-sm">
                            <i class="fas fa-database"></i> Manage Backups
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-cogs fa-2x text-info mb-3"></i>
                        <h6 class="card-title">Django Admin</h6>
                        <p class="card-text text-muted">Access full Django administration panel</p>
                        <a href="{{ django_admin_url }}" target="_blank" class="btn btn-info btn-sm">
                            <i class="fas fa-external-link-alt"></i> Open Django Admin
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-file-export fa-2x text-success mb-3"></i>
                        <h6 class="card-title">Data Export</h6>
                        <p class="card-text text-muted">Export system data in various formats</p>
                        <div class="btn-group">
                            <button type="button" class="btn btn-success btn-sm dropdown-toggle" data-toggle="dropdown">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="{% url 'super_owner:export_data' 'users' %}">
                                    <i class="fas fa-users"></i> Users
                                </a>
                                <a class="dropdown-item" href="{% url 'super_owner:export_data' 'companies' %}">
                                    <i class="fas fa-building"></i> Companies
                                </a>
                                <a class="dropdown-item" href="{% url 'core:export_data' 'all' %}">
                                    <i class="fas fa-database"></i> All Data
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <i class="fas fa-shield-alt fa-2x text-warning mb-3"></i>
                        <h6 class="card-title">System Logs</h6>
                        <p class="card-text text-muted">View security logs and system events</p>
                        <a href="/admin/" target="_blank" class="btn btn-warning btn-sm">
                            <i class="fas fa-external-link-alt"></i> View Admin
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status -->
        <div class="card mb-4">
            <div class="card-header">
                <h5 class="card-title">
                    <i class="fas fa-server"></i> System Status
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="status-indicator status-success"></div>
                            <h6 class="mt-2">Database</h6>
                            <small class="text-muted">Connected & Responsive</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="status-indicator status-success"></div>
                            <h6 class="mt-2">Cache</h6>
                            <small class="text-muted">Redis Available</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="status-indicator status-success"></div>
                            <h6 class="mt-2">Email Service</h6>
                            <small class="text-muted">SMTP Connected</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center">
                            <div class="status-indicator status-success"></div>
                            <h6 class="mt-2">File Storage</h6>
                            <small class="text-muted">AWS S3 Available</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title">
                            <i class="fas fa-info-circle"></i> System Information
                        </h6>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm">
                            <tr>
                                <td><strong>Django Version</strong></td>
                                <td>5.2</td>
                            </tr>
                            <tr>
                                <td><strong>Python Version</strong></td>
                                <td>3.13</td>
                            </tr>
                            <tr>
                                <td><strong>Database</strong></td>
                                <td>PostgreSQL 16.x</td>
                            </tr>
                            <tr>
                                <td><strong>Cache Backend</strong></td>
                                <td>Redis</td>
                            </tr>
                            <tr>
                                <td><strong>Environment</strong></td>
                                <td>
                                    {% if debug %}
                                        <span class="badge badge-warning">Development</span>
                                    {% else %}
                                        <span class="badge badge-success">Production</span>
                                    {% endif %}
                                </td>
                            </tr>
                            <tr>
                                <td><strong>Uptime</strong></td>
                                <td>99.9%</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h6 class="card-title">
                            <i class="fas fa-tasks"></i> Quick Actions
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Clear Cache</h6>
                                    <small class="text-muted">Clear application cache</small>
                                </div>
                                <button class="btn btn-outline-danger btn-sm" onclick="clearCache()">
                                    <i class="fas fa-trash"></i> Clear
                                </button>
                            </div>
                            
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Restart Services</h6>
                                    <small class="text-muted">Restart background services</small>
                                </div>
                                <button class="btn btn-outline-warning btn-sm" onclick="restartServices()">
                                    <i class="fas fa-sync-alt"></i> Restart
                                </button>
                            </div>
                            
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Run Migrations</h6>
                                    <small class="text-muted">Apply pending database migrations</small>
                                </div>
                                <button class="btn btn-outline-info btn-sm" onclick="runMigrations()">
                                    <i class="fas fa-database"></i> Migrate
                                </button>
                            </div>
                            
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-1">Collect Static Files</h6>
                                    <small class="text-muted">Update static file collection</small>
                                </div>
                                <button class="btn btn-outline-primary btn-sm" onclick="collectStatic()">
                                    <i class="fas fa-file-code"></i> Collect
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Maintenance -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-wrench"></i> Maintenance Tasks
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <strong>Scheduled Maintenance:</strong> All maintenance tasks are performed automatically. 
                            Manual intervention is only needed for emergency situations.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card border">
                                    <div class="card-body text-center">
                                        <i class="fas fa-calendar-alt fa-2x text-primary mb-3"></i>
                                        <h6>Daily Cleanup</h6>
                                        <p class="text-muted">Clean up temporary files and logs</p>
                                        <small class="text-success">Last run: 2 hours ago</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card border">
                                    <div class="card-body text-center">
                                        <i class="fas fa-database fa-2x text-success mb-3"></i>
                                        <h6>Database Optimization</h6>
                                        <p class="text-muted">Optimize database indexes and tables</p>
                                        <small class="text-success">Last run: 1 day ago</small>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <div class="card border">
                                    <div class="card-body text-center">
                                        <i class="fas fa-backup fa-2x text-info mb-3"></i>
                                        <h6>Automated Backups</h6>
                                        <p class="text-muted">Create system backups</p>
                                        <small class="text-success">Last run: 6 hours ago</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function clearCache() {
    if (confirm('Are you sure you want to clear the application cache?')) {
        // This would call an API endpoint to clear cache
        alert('Cache clearing functionality would be implemented here.');
    }
}

function restartServices() {
    if (confirm('Are you sure you want to restart background services? This may cause temporary disruption.')) {
        alert('Service restart functionality would be implemented here.');
    }
}

function runMigrations() {
    if (confirm('Are you sure you want to run database migrations?')) {
        alert('Migration functionality would be implemented here.');
    }
}

function collectStatic() {
    if (confirm('Are you sure you want to collect static files?')) {
        alert('Static file collection functionality would be implemented here.');
    }
}

// System status check (mock)
function checkSystemStatus() {
    // This would make AJAX calls to check actual system status
    console.log('Checking system status...');
}

// Check status every 30 seconds
setInterval(checkSystemStatus, 30000);
</script>

<style>
.status-indicator {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    margin: 0 auto;
    position: relative;
}

.status-indicator.status-success {
    background-color: #10b981;
    box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
}

.status-indicator.status-warning {
    background-color: #f59e0b;
    box-shadow: 0 0 10px rgba(245, 158, 11, 0.5);
}

.status-indicator.status-danger {
    background-color: #ef4444;
    box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);
}

.status-indicator.status-success::after {
    content: '';
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: #10b981;
    position: absolute;
    top: 0;
    left: 0;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
    }
    
    70% {
        transform: scale(1);
        box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
    }
    
    100% {
        transform: scale(0.95);
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
    }
}

.card.border {
    border: 1px solid var(--gray-200) !important;
}

.btn-group .dropdown-menu {
    min-width: 150px;
}
</style>
{% endblock %}
